{% extends "base.html" %}

{% block title %}Chronic Diseases{% endblock %}

{% block content %}

    <div class="menu-container">
        <!-- Disease Menu -->
        <div class="menu">
            {% for name in names %}
            <div class="menu-header" onclick="toggleMenu('disease-menu-{{ loop.index }}')">{{name}}</div>
            <div id="disease-menu-{{ loop.index }}" class="menu-content">
                <div class="item">Probability : {{prob[name]}}</div>
                <!-- Feature Vector Submenu -->
                <div class="submenu">
                    <div class="submenu-header" onclick="toggleSubmenu('feature-vector-menu-{{ loop.index }}')">Feature Vector</div>
                    <div id="feature-vector-menu-{{ loop.index }}" class="submenu-content">
                        {% if vector %}
                            <table>
                                <thead>
                                    <tr>
                                        <th>Feature</th>
                                        <th>Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for key, value in vector[name].items() %}
                                        <tr>
                                            <td>{{ key }}</td>
                                            <td>{{ value }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>No feature data available.</p>
                        {% endif %}
                    </div>
                </div>
                <!-- Important Features Submenu -->
                <div class="submenu">
                    <div class="submenu-header" onclick="toggleSubmenu('important-features-menu-{{ loop.index }}')">Important Features</div>
                    <div id="important-features-menu-{{ loop.index }}" class="submenu-content">
                            {% if imp %}
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Feature</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for important in imp[name] %}
                                            <tr>
                                                <td>{{important["Feature"]}}</td>
                                                <td>{{ important["Value"] }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                <p>No feature data available.</p>
                            {% endif %}
                    </div>
                </div>
                <!-- Risky Features Submenu -->
                <div class="submenu">
                    <div class="submenu-header" onclick="toggleSubmenu('risky-features-menu-{{ loop.index }}')">Risky Features</div>
                    <div id="risky-features-menu-{{ loop.index }}" class="submenu-content">
                            {% if risk %}
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Feature</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for risky in risk[name] %}
                                            <tr>
                                                <td>{{ risky["Feature"] }}</td>
                                                <td>{{ risky["Value"] }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                <p>No feature data available.</p>
                            {% endif %}
                    </div>
                </div>
<!-- Prediction Rules Submenu -->
<div class="submenu">
    <div class="submenu-header" onclick="toggleSubmenu('prediction-rules-menu-{{ loop.index }}')">Prediction Rules</div>
    <div id="prediction-rules-menu-{{ loop.index }}" class="submenu-content">
        {% for rule in rules[name] %}
            <div class="submenu-item">
                <!-- Header for each rule to toggle its content -->
                 <hr>
                <div class="rule-header" onclick="toggleRuleContent('rule-content-{{ loop.index }}-{{ loop.index }}')">
                    Rule {{ loop.index }}
                </div>
                <!-- Content for each rule -->
                <div id="rule-content-{{ loop.index }}-{{ loop.index }}" class="rule-content">
                    <p>{{ rule.English }}</p>
                    <p>Outcome: {{ rule["Predicate"]["Result"]["Outcome"] }}</p>
                    <p>Probability: {{ rule["Predicate"]["Result"]["Probability"] }}</p>
                    <p>Support: {{ rule["Support"] }}</p>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // General Collapsible Menu Handling
            const collapsibles = document.querySelectorAll('.collapsible-menu');
        
            collapsibles.forEach(button => {
                button.addEventListener('click', function () {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
        
                    if (content.style.display === 'block') {
                        content.style.display = 'none';
                    } else {
                        content.style.display = 'block';
                    }
                });
            });
        
            // Disease Menu and Submenu Handling
            function toggleMenu(menuId) {
                const menu = document.getElementById(menuId);
                menu.classList.toggle('show');
            }
        
            function toggleSubmenu(submenuId) {
                const submenu = document.getElementById(submenuId);
                submenu.classList.toggle('show');
            }
        
            function toggleRuleContent(ruleContentId) {
                const ruleContent = document.getElementById(ruleContentId);
                ruleContent.classList.toggle('show');
            }
        
            // Event Listeners for Disease Menu and Submenus
            const diseaseMenuHeaders = document.querySelectorAll('.menu-header');
            diseaseMenuHeaders.forEach(diseaseMenuHeader => {
                diseaseMenuHeader.addEventListener('click', function () {
                    const menuId = this.nextElementSibling.id;
                    toggleMenu(menuId);
                });
            });
        
            const submenuHeaders = document.querySelectorAll('.submenu-header');
            submenuHeaders.forEach(submenuHeader => {
                submenuHeader.addEventListener('click', function () {
                    const submenuId = this.nextElementSibling.id;
                    toggleSubmenu(submenuId);
                });
            });
        
            const ruleHeaders = document.querySelectorAll('.rule-header');
            ruleHeaders.forEach(ruleHeader => {
                ruleHeader.addEventListener('click', function () {
                    const ruleContentId = this.nextElementSibling.id;
                    toggleRuleContent(ruleContentId);
                });
            });
        });
    </script>
{% endblock %}