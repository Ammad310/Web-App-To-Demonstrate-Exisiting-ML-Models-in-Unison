<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor App</title>
 
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
 
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer">
 
    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
 
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body>
 
    <!-- Yellow Strip -->
    <div class="yellow-strip">
    <img src="static/imgs/header.jfif" alt="Logo">
    <a> Prediction System </a>
    </div>
 
    <!-- Main Content -->
    <main>
        <section class="py-5">
            <div class="container patient-details-section">
                <form id="patientForm" action="/" method="POST" class="patient-details-form">
                    <h1 class="text-center text-yellow mb-4">Enter Patient Details</h1>
                    <div class="mb-3">
                        <input class="form-control" type="text" id="PID" name="PID" placeholder="Enter patient's ID here" required>
                    </div>
                    <div class="mb-3">
                        <select class="form-control" id="PP" name="PP" required>
                            <option value="" disabled selected>Select patient's practice</option>
                            {% for practice in practices %}
                                <option value="{{ practice.practice }}">{{ practice.practice }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button id="showResponse" type="button" class="btn btn-yellow mt-3">Diagnosed Disease</button>
                    {% with messages = get_flashed_messages() %}
                    {% if messages %}
                    <div class="alert alert-success mt-3">
                        {% for message in messages %}
                            {{ message }}
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% endwith %}
                </form>
            </div>
        </section>
 
        <section class="py-5">
            <div class="container">
                <div class="feature-row">
                    <div class="feature-card">
                        <img src="static/imgs/Chronic_Diseases.png" alt="Chronic Disease" class="img-feature">
                        <h3 class="feature-title text-yellow">An Explainable Disease Surveillance System For Early Prediction of Multiple Chronic Diseases</h3>
                        <p class="feature-description">Description</p>
                    </div>
                    <div class="feature-card">
                        <img src="static/imgs/lab_testing.png" alt="Lab Testing" class="img-feature">
                        <h3 class="feature-title text-yellow">A Hybrid AI and Rule-Based CDSS for Disease Diagnosis and Management Using Labs</h3>
                        <p class="feature-description">Description</p>
                    </div>
                    <div class="feature-card">
                        <img src="static/imgs/pattern_mining.png" alt="Pattern Mining" class="img-feature">
                        <h3 class="feature-title text-yellow">Mining Diseases Progression Patterns for Advanced Disease Surveillance</h3>
                        <p class="feature-description">Description</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
 
    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("patientForm");
            const showResponseButton = document.getElementById("showResponse");
            const practiceSelect = document.getElementById("PP");
    
            form.onsubmit = async function (e) {
                e.preventDefault();
    
                const formData = new FormData(form);
                const response = await fetch('/', {
                    method: 'POST',
                    body: formData
                });
    
                const result = await response.json();
                if (response.ok && result.status === 'success') {
                    window.location.href = "/diagnose"; // Redirect to /diagnose
                } else {
                    // Handle the error response
                    const alertDiv = document.querySelector('.alert');
                    if (alertDiv) {
                        alertDiv.textContent = result.message;
                    } else {
                        const newAlertDiv = document.createElement('div');
                        newAlertDiv.className = 'alert alert-danger mt-3';
                        newAlertDiv.textContent = result.message;
                        form.insertAdjacentElement('afterend', newAlertDiv);
                    }
                }
            };

            // Ensure this button click works if it should handle form submission
            showResponseButton.onclick = function () {
                form.requestSubmit(); // Triggers the form submission
            };

            // Initialize Select2 on the practice select element
            $(practiceSelect).select2({
                placeholder: "Select patient's practice",
                allowClear: true,
                tags: true, // Allow free text input
                createTag: function (params) {
                    return {
                        id: params.term,
                        text: params.term,
                        newOption: true
                    };
                },
                templateResult: function (data) {
                    const $result = $("<span></span>");
                    $result.text(data.text);
                    if (data.newOption) {
                        $result.append(" <em>(new)</em>");
                    }
                    return $result;
                }
            });
        });
    </script>
</body>
</html>